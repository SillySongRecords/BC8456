<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale $=1.0">$
<title>Browncow Distribution</title>
<script src="https://cdn.tailwindcss.com"></script>
<link
href="https://fonts.googleapis.com/css?family=Inter:wght@400;500;600;700&display=swap"
 rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
 <style>
body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
.theme-purple { background-color: #5a4ae3; }
theme-text { color: #5a4ae3; }
theme-border { border-color: #5a4ae3; }
.btn-primary { background-color: #5a4ae3; color: white; transition: background-color 0.3s; }
.btn-primary:hover { background-color: #4b3bc5; }
.btn-primary:disabled { background-color: #a5b4fc; cursor: not-allowed; }
.btn-secondary { background-color: #e2e8f0; color: #475569; transition: background-color
0.3s; }
.btn-secondary:hover { background-color: #cbd5e1; }
.no-scrollbar::-webkit-scrollbar { display: none; }
.no-scrollbar {-ms-overflow-style: none; scrollbar-width: none; }
.view { display: none; }
.active-view { display: block; }
.animate-spin { animation: spin 1s linear infinite; }
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
 .progress-bar { background-color: #e2e8f0; border-radius: 9999px;
overflow: hidden; }
 progress-bar-inner { background-color: #5a4ae3; height: 100%; transition: width 0.3s
 ease-in-out; }
/* Modal Styles */
.modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height:
 100%; overflow: auto; background-color: rgba(0,0,0,0.5);
}
.modal-content { background-color: #fefefe; margin: 5% auto; padding: 25px; border: 1px
 solid #888; width: 80%; max-width: 700px; border-radius: 12px; }
.modal-header { display: flex; justify-content: space-between; align-items: center;
border-bottom: 1px solid #e5e7eb; padding-bottom: 1rem; }
.modal-close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
 modal-close:hover, .modal-close:focus { color: black; text-decoration: none;
}
input:disabled, select:disabled, textarea:disabled { background-color: #f3f4f6; cursor:
not-allowed; }
</style>
</head>
<body class="bg-gray-50">
<div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center
 justify-center hidden">
<div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white"></div>
 </div>
<div id="toast" class="fixed top-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg
 shadow-lg hidden transition-opacity duration-300">
<p id="toast-message"></p>
</div>
<div id="auth-view" class="view active-view min-h-screen flex items-center justify-center
 bg-gray-100">
<div class="w-full max-w-md p-8 space-y-8 bg-white rounded-2xl shadow-lg">
 <div id="login-form">
<div class="text-center">
<h2 class="text-3xl font-bold text-gray-900"><span
class="theme-text">Browncow</span> Distribution</h2>
<p class="mt-2 text-sm text-gray-600">Welcome back! Please sign in.</p>
 </div>
<form class="mt-8 space-y-6" onsubmit="handleLogin(event)">
<div class="rounded-md shadow-sm-space-y-px">
<div><input id="login-email" name="email" type="email" autocomplete="email"
required class="appearance-none rounded-none relative block w-full px-3 py-2 border
 border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none
 focus:ring-purple-500 focus:border-purple-500 focus:z-10 sm:text-sm" placeholder="Email
 address"></div>
<div><input id="login-password" name="password" type="password"
 autocomplete="current-password" required class="appearance-none rounded-none relative
 block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md
 focus:outline-none focus:ring-purple-500 focus:border-purple-500 focus:z-10 sm:text-sm"
 placeholder="Password"></div>
</div>
<div><button type="submit" class="group relative w-full flex justify-center py-2 px-4
border border-transparent text-sm font-medium rounded-md text-white bg-purple-600
 hover:bg-purple-700 focus: outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500
 btn-primary">Sign in</button></div>
</form>
<div class="text-sm text-center mt-4"><a href="#" id="show-signup" class="font-medium
 theme-text hover: text-purple-500">Don't have an account? Sign up</a></div>
 </div>
<div id="signup-form" class="hidden">
<div class="text-center">
<h2 class="text-3xl font-bold text-gray-900"><span
class="theme-text">Browncow</span> Distribution</h2>
<p class="mt-2 text-sm text-gray-600">Create your account to get started.</p>
 </div>
<form class="mt-8 space-y-6" onsubmit="handleSignup (event)">
<div class="rounded-md shadow-sm">
<input id="signup-name" type="text" required class="appearance-none rounded-md
relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900
 focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm mb-2"
 placeholder="Full Name or Artist Name">
<input id="signup-email" type="email" required class="appearance-none
 rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500
 text-gray-900 focus: outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm
 mb-2" placeholder="Email address">
<input id="signup-password" type="password" required class="appearance-none
 rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500
 text-gray-900 focus: outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm"
 placeholder="Password (min. 6 characters)">
</div>
<div><button type="submit" class="group relative w-full flex justify-center py-2 px-4
 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600
 hover:bg-purple-700 focus: outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500
 btn-primary">Sign up</button></div>
</form>
<div class="text-sm text-center mt-4"><a href="#" id="show-login" class="font-medium
 theme-text hover:text-purple-500">Already have an account? Sign in</a></div>
</div>
</div>
</div>
<div id="app-view" class="view">
<div class="flex h-screen bg-gray-100">
<div class="hidden md:flex flex-col w-64 bg-white shadow-lg">
<div class="flex items-center justify-center h-16 bg-white border-b">
<h1 class="text-2xl font-bold theme-text">Browncow</h1>
</div>
<div class="flex flex-col flex-grow p-4">
<nav id="user-nav" class="flex-grow space-y-2"></nav>
<nav id="admin-nav" class="flex-grow space-y-2 hidden"></nav>
<div class="mt-auto">
<a href="#" onclick="handleLogout()" class="flex items-center px-4 py-2 mt-2
text-sm font-medium text-gray-600 rounded-md hover:bg-gray-200">
<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"
 xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round"
stroke-width="2" d="M17 1614-4m0 01-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0
 013-3h4a3 3 0 013 3v1"></path></svg>
Logout
</a>
</div>
</div>
</div>
<div class="flex flex-col flex-1 overflow-y-auto">
<header class="flex items-center justify-between h-16 bg-white border-b px-6">
 <div class="flex items-center">
<button id="mobile-menu-button" class="md:hidden mr-4 text-gray-600">
<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"
 xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round"
 stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
</button>
<h1 id="page-title" class="text-xl font-semibold text-gray-800">Dashboard</h1>
</div>
<div class="flex items-center">
<span id="user-greeting" class="text-sm text-gray-600"></span>
</div>
</header>
<main class="p-6 md:p-10 space-y-8">
<div id="content-area"></div>
</main>
</div>
</div>
<div id="mobile-menu" class="fixed inset-0 flex z-40 md:hidden hidden">
<div class="fixed inset-0 bg-black opacity-25" id="mobile-menu-overlay"></div>
<div class="relative flex-1 flex flex-col max-w-xs w-full bg-white">
<div class="absolute top-0 right-0-mr-12 pt-2">
<button id="mobile-menu-close" class="ml-1 flex items-center justify-center h-10 w-10
rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white">
<svg class="h-6 w-6 text-white" stroke="currentColor" fill="none" viewBox="0 0 24
 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6
 6112 12" /></svg>
</button>
</div>
<div class="flex-1 h-0 pt-5 pb-4 overflow-y-auto">
<div class="flex-shrink-0 flex items-center px-4">
<h1 class="text-2xl font-bold theme-text">Browncow</h1>
</div>
<nav id="mobile-user-nav" class="mt-5 px-2 space-y-1"></nav>
<nav id="mobile-admin-nav" class="mt-5 px-2 space-y-1 hidden"></nav>
</div>
<div class="flex-shrink-0 flex border-t p-4">
<a href="#" onclick="handleLogout()" class="flex-shrink-0 group block">
 <div class="flex items-center">
<div>
<svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M17 1614-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3
 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
</div>
<div class="ml-3">
<p class="text-sm font-medium text-gray-700
group-hover:text-gray-900">Logout</p>
</div>
</div>
</a>
</div>
</div>
</div>
</div>
<div id="release-details-modal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2 class="text-xl font-bold text-gray-800">Release Metadata</h2>
<span class="modal-close"
onclick="document.getElementById('release-details-modal').style.display='none'">&times;</span
>
</div>
<div class="mt-4">
<div class="p-3 mb-4 text-sm text-blue-800 rounded-lg bg-blue-100" role="alert">
This information is locked. To request a metadata update, please contact support.
</div>
<form id="view-release-form" class="space-y-4">
<fieldset disabled>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div><label class="block text-sm font-medium text-gray-700">Song
 Title</label><input type="text" id="view-song Title" class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm sm:text-sm"></div>
<div><label class="block text-sm font-medium text-gray-700">Primary
 Artist</label><input type="text" id="view-primaryArtist" class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm sm:text-sm"></div>
<div><label class="block text-sm font-medium text-gray-700">Featured
Artists</label><input type="text" id="view-featured Artists" class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm sm:text-sm"></div>
<div><label class="block text-sm font-medium text-gray-700">Release
 Date</label><input type="date" id="view-release Date" class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm sm:text-sm"></div>
<div><label class="block text-sm font-medium
text-gray-700">Genre</label><input type="text" id="view-genre" class="mt-1 block w-full
 rounded-md border-gray-300 shadow-sm sm:text-sm"></div>
<div><label class="block text-sm font-medium text-gray-700">Record
 Label</label><input type="text" id="view-recordLabel" class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm sm:text-sm"></div>
<div><label class="block text-sm font-medium text-gray-700">UPC</label><input
 type="text" id="view-upc" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm
 sm:text-sm"></div>
<div><label class="block text-sm font-medium
text-gray-700">ISRC</label><input type="text" id="view-isrc" class="mt-1 block w-full
 rounded-md border-gray-300 shadow-sm sm:text-sm"></div>
</div>
<div class="mt-4"><label class="block text-sm font-medium text-gray-700">Spotify
 Profile URL</label><input type="url" id="view-spotifyLink" class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm sm:text-sm"></div>
<div class="mt-4"><label class="block text-sm font-medium text-gray-700">Apple
 Music Profile URL</label><input type="url" id="view-appleLink" class="mt-1 block w-full
 rounded-md border-gray-300 shadow-sm sm:text-sm"></div>
<div class="mt-4"><label class="block text-sm font-medium
text-gray-700">YouTube Music Profile URL</label><input type="url" id="view-youtube Link"
 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm sm:text-sm"></div>
</fieldset>
</form>
</div>
</div>
</div>
<script type="module">
// Firebase and App imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
 import { getAuth, create UserWithEmailAndPassword, signIn With EmailAnd Password,
 onAuthState Changed, signOut, updateProfile } from
"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, addDoc, collection, query, where, getDocs,
onSnapshot, updateDoc, orderBy, serverTimestamp, deleteDoc, increment } from
"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
// IMPORTANT: Replace with your Firebase project configuration
 const firebaseConfig = {
};
apiKey: "AlzaSyBimPDyP_2XWcuwvOpVUcfCAJE-G5pDrqs",
 authDomain: "bccr-899f8.firebaseapp.com",
projectid: "bccr-899f8",
storageBucket: "bccr-899f8.firebasestorage.app",
messagingSenderld: "630028306842",
appld: "1:630028306842:web:67bcefc01a26024d4ed223"
// IMPORTANT: Replace with your Cloudinary configuration
const CLOUDINARY_CLOUD_NAME = "dp9on02kr";
const CLOUDINARY_UPLOAD_PRESET = "bccccc";
// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
let currentUser = null;
let isAdmin = false;
// --- UI Elements
const authView = document.getElementById('auth-view');
 const appView = document.getElementById('app-view');
const contentArea = document.getElementById('content-area');
 const page Title = document.getElementById('page-title');
const userGreeting = document.getElementById('user-greeting');
 const loadingOverlay = document.getElementById('loading-overlay');
 const toast = document.getElementById('toast');
const toastMessage = document.getElementById('toast-message');
// --- Navigation Setup
const userNavLinks = [
{ name: 'Dashboard', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M3 1212-2m0 017-7 7 7M5 10v10a1 1 0 001
 1h3m10-1112 2m-2-2v10a1 1001-1 1h-3m-6 0a1 1000-1-1v-4a110 011-1h2a1 10011 1v4a1
 10 001 1m-6 0h6"></path></svg>', view: 'user-dashboard' },
{name: 'Create Release', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width $=^{\prime\prime}2"$ d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>',
 view: 'create-release' },
{ name: 'My Releases', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M9 19V6112-3v13M9 19c0 1.105-1.343 2-3
 2s-3-.895-3-2 1.343-2 3-2 3.895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3
 .895 3 2zM9 6112-3"></path></svg>', view: 'my-releases' },
{ name: 'Analytics', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945
 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
 d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>', view: 'analytics' },
{ name: 'Payouts', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002
 2h2m2 4h10a2 20 002-2v-6a2 2000-2-2H9a2 2000-2 2v6a2 2 0 002 2zm7-5a2 20 11-4 0 2 2
 0 014 0z"></path></svg>', view: 'payouts' },
// NEW: Account/Payment Settings Link
{ name: 'Account', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7
 7h14a7 7 0 00-7-7z"></path></svg>', view: 'account-settings' }
];
const adminNavLinks = [
{ name: 'All Releases', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0
 002-2V7a2 2000-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 20 012-2h2a2 20 012 2m-6
 912 2 4-4"></path></svg>', view: 'admin-releases' },
{ name: 'Manage Users', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0
 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 60 00-9-5.197M15 11a3 3 0 11-6 0 3 3 0 016
 Oz"></path></svg>', view: 'admin-users' },
// NEW: Admin Payouts Management Link
{name: 'Payouts', icon: '<svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor"
 viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round"
 stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002
 2h2m2 4h10a2 20 002-2v-6a2 20 00-2-2H9a2 2000-2 2v6a220002 2zm7-5a2 2 0 11-4 022
 0 014 0z"></path></svg>', view: 'admin-payouts' }
];
function createNavLink(link, index) {
 const isActive = index === 0;
return  <a href="#" data-view="\${link.view}" class="nav-link \${isActive? 'bg-purple-100
 theme-text': 'text-gray-600'} flex items-center px-4 py-2 text-sm font-medium rounded-md
 hover:bg-gray-200">\${link.icon} \${link.name}</a>';
}
// --- Authentication Logic ---
window.handleLogin = async (e) => {
e.preventDefault();
showLoading(true);
const email = document.getElementById('login-email').value;
const password = document.getElementById('login-password').value;
try {
await signInWithEmailAndPassword(auth, email, password);
show Toast('Login successful!');
} catch (error) {
console.error("Login Error:", error);
show Toast( Error: \${error.message}', 'error');
} finally {
showLoading(false);
}
};
window.handleSignup = async (e) => {
e.preventDefault();
showLoading(true);
const name = document.getElementById('signup-name').value;
const email = document.getElementById('signup-email').value;
const password = document.getElementById('signup-password').value;
try {
const userCredential = await createUserWithEmailAndPassword(auth, email, password);
const user = userCredential.user;
await updateProfile(user, { displayName: name });
await setDoc(doc(db, "users", user.uid), {
});
name: name,
email: email,
createdAt: server Timestamp(),
isAdmin: false,
balance: 0
show Toast('Signup successful! Welcome.');
} catch (error) {
console.error("Signup Error:", error)
;
show Toast( Error: \${error.message}', 'error');
} finally {
showLoading(false);
}
};
window.handleLogout = async () => {
};
showLoading(true);
await signOut(auth);
currentUser = null;
isAdmin = false;
show Toast('Logged out successfully.');
showLoading(false);
onAuthStateChanged(auth, async (user) => {
if (user) {
showLoading(true);
currentUser = user;
const userDoc = await getDoc(doc(db, "users", user.uid));
if (userDoc.exists() && userDoc.data().isAdmin) {
isAdmin = true;
} else {
}
isAdmin = false;
if (!user.displayName && userDoc.exists()) {
}
await updateProfile (user, { displayName: userDoc.data().name });
userGreeting.textContent = 'Hello, \${user.displayName || user.email}';
setupAppUI();
authView.classList.remove('active-view');
appView.classList.add('active-view');
showLoading(false);
} else {
currentUser = null;
isAdmin = false;
authView.classList.add('active-view');
appView.classList.remove('active-view');
}
});
// --- UI & View Management
function setupAppUI() {
const userNavContainer = document.getElementById('user-nav');
const adminNavContainer = document.getElementById('admin-nav');
const mobileUserNavContainer = document.getElementById('mobile-user-nav');
const mobileAdminNavContainer = document.getElementById('mobile-admin-nav');
 
 if 
 (isAdmin) {
 
 userNavContainer.classList.add('hidden');
mobileUserNavContainer.classList.add('hidden');
 
 adminNavContainer.classList.remove('hidden');
 
 mobileAdminNavContainer.classList.remove('hidden');
 
 adminNavContainer.innerHTML = adminNavLinks.map((link, i) => createNavLink(link,
 i)).join('');
 
 mobileAdminNavContainer.innerHTML = adminNavLinks.map((link, i) =>
 createNavLink(link, i)).join('');
 
 navigateTo('admin-releases');
} else {
 
 userNavContainer.classList.remove('hidden');
 
 mobileUserNavContainer.classList.remove('hidden');
 
 adminNavContainer.classList.add('hidden');
 
 mobileAdminNavContainer.classList.add('hidden');
userNavContainer.innerHTML = userNavLinks.map((link, i) => createNavLink(link,
 i)).join('');
 
 mobileUserNavContainer.
case 'create-release': renderCreateReleaseForm(); break;
 
 case 'my-releases': renderMyReleases(); break;
 
 case 'release-details': renderReleaseDetails(id); break;
 
 case 'analytics': renderAnalytics(); break;
 
 case 'payouts': renderPayouts(); break;
// NEW: Account Settings case
 
 case 'account-settings': renderAccountSettings(); break;
case 'admin-releases': renderAdminReleases(); break;
 
 case 'admin-users': renderAdminUsers(); break;
 
 // NEW: Admin Payouts case
 
 case 'admin-payouts': renderAdminPayouts();
break;
 
 }
 
 document.getElementById('mobile-menu').classList.add('hidden');
}
 
 // --- NEW: Render Functions for New Views ---
 
 // NEW: Function to render the Account/Payment Settings page
 
 async function renderAccountSettings() {
 
 contentArea.innerHTML = `<div class="bg-white p-8 rounded-xl shadow-md max-w-2xl
 mx-auto">Loading
} else {
 
 // User needs to set up payment info
 
 contentArea.innerHTML = `
 
 <div class="bg-white p-8 rounded-xl shadow-md max-w-2xl mx-auto">
 
 <h2 
 class="text-2xl font-bold text-gray-800 mb-6">Setup Your Payout Method</h2>
 
<p class="text-gray-600 mb-6">You must set up a payout method before you can
 request your earnings.
This information can only be changed by contacting support once
 saved.</p>
 
 <form id="payout-setup-form">
 
 <div class="space-y-4">
 
 <label class="font-semibold text-gray-700">Choose a method:</label>
 
<div class="flex items-center gap-4">
 
 <label><input type="radio" name="payoutMethod" value="paypal"
 class="mr-2" checked> PayPal</label>
 
 <label><input type="radio" name="payoutMethod" value="check"
 class="mr-2"> 
Paper Check</label>
document.getElementById('paypal-fields').classList.toggle('hidden', !isPaypal);
 
 document.getElementById('check-fields').classList.toggle('hidden', isPaypal);
 
 document.getElementById('paypalEmail').required = isPaypal;
 
 document.getElementById('legalName').required = !isPaypal;
 
 document.getElementById('mailingAddress').required = !isPaypal;
 
 }));
 
 form.addEventListener('submit', handleSavePaymentInfo);
}
 
 }
 
 // NEW: Function to render the Admin Payouts page
 
 function renderAdminPayouts() {
 
 contentArea.innerHTML = `
 
 <div class="space-y-8">
 
 <div class="bg-white p-6 rounded-xl shadow-md">
 
 <h3 class="text-xl font-semibold text-gray-800 mb-4">Pending Payout
 Requests</h3>
 
<div id="admin-payouts-list" class="space-y-4"><p>Loading payout
 requests...</p></div>
 
 </div>
 
 <div
payoutDetails = `<strong>PayPal:</strong> ${userData.paypalEmail}`;
 
 } else if (userData.payoutMethod === 'check') {
 
 payoutDetails = `<strong>Check to:</strong>
 ${userData.legalName}<br><strong>Address:</strong> ${userData.mailingAddress}`;
}
 
 return `
 
 <div class="p-4 border rounded-lg bg-gray-50">
 
 <div class="flex flex-col md:flex-row md:items-center md:justify-between">
 
<div>
 
 <p class="font-bold text-lg
 text-gray-800">$${payout.amount.toFixed(2)}</p>
 
 <p class="text-sm text-gray-600">To: <strong>${payout.userName ||
payout.userEmail}</strong></p>
 
 <p class="text-sm text-gray-500 mt-1">Requested on: ${new
 Date(payout.requestedAt.seconds * 1000).toLocaleDateString()}</p>
 
 </div>
 
 <div
const historyHtml = snapshot.docs.map(doc => {
 
 const payout = { id: doc.id, ...doc.data() };
 
 const isApproved = payout.status === 'approved';
 
 const statusClass = isApproved ? 'text-green-600 bg-green-100' : 'text-red-600
 bg-red-100';
 
 return `
 
<div class="p-3 border rounded-md flex justify-between items-center">
 
 <div>
 
 <p class="font-semibold">$${payout.amount.toFixed(2)} to
 ${payout.userName}</p>
 
<p class="text-xs text-gray-500">${new Date(payout.requestedAt.seconds *
 1000).toLocaleString()}</p>
 
 </div>
 
 <span class="text-xs font-medium px-2.5 py-0.5 rounded-full
 ${statusClass}">${payout.status}</span>
 
 </div>`;
}).join('');
 
 historyEl.innerHTML = historyHtml;
 
 });
 
 }
 
 // --- Core Render Functions (Modified) ---
const q = query(collection(db, "releases"), where("userId", "==", currentUser.uid),
 orderBy("createdAt", "desc"));
onSnapshot(q, (querySnapshot) => {
 
 const releases = querySnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
 
 document.getElementById('total-releases').textContent = releases.length;
 
 document.getElementById('live-releases').textContent = releases.filter(r => r.status ===
 'delivered').length;
 
 const recentList = document.getElementById('recent-releases-list');
 
 if 
 (releases.length > 0) {
 
recentList.innerHTML = releases.slice(0, 3).map(release =>
 renderReleaseCard(release, false)).join('');
 
 } else {
 
 recentList.innerHTML = `<p class="text-gray-500">You haven't created any releases
 yet.</p>`;
 
 }
 
 });
}
 
 function renderCreateReleaseForm() {
 
 const commonDsps = ['Amazon Music', 'Anghami', 'Apple Music', 'Audiomack', 'Deezer',
<label class="block text-sm font-medium text-gray-700 mb-1">Artwork
 (JPG/PNG, 3000x3000px)</label>
 
 <img id="artwork-preview" class="h-32 w-32 rounded-lg object-cover
 bg-gray-100 mb-2 hidden" src="#" alt="Artwork Preview">
 
 <input type="file" id="artwork-file" required class="block w-full text-sm
 text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm
 file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100">
 
<div id="artwork-upload-progress" class="progress-bar mt-2 h-2.5 w-full
 hidden"><div class="progress-bar-inner"></div></div>
 
 </div>
 
 </div>
 
 <div class="mt-6">
 
<label class="block text-sm font-medium text-gray-700 mb-1">Supporting
 Documentation (optional)</label>
 
 <p class="text-xs text-gray-500 mb-2">Upload
<div><label class="block text-sm font-medium text-gray-700">Release
 Date</label><input type="date" id="release-date" required class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm"></div>
 
 <div><label class="block text-sm font-medium
 text-gray-700">Genre</label><select id="genre" required class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500
 sm:text-sm">${genres.map(g => `<option value="${g}">${g}</option>`).join('')}</select></div>
 
 <div id="other-genre-container" class="hidden md:col-span-2"><label
 class="block text-sm font-medium text-gray-700">Please specify genre</label><input
 type="text" id="other-genre-specify" class="mt-1 block w-full 
rounded-md border-gray-300
 shadow-sm"></div>
 
 <div class="md:col-span-2"><label class="block text-sm font-medium
 text-gray-700">Has this
<label class="block text-sm font-medium text-gray-700">Apple Music Artist
 Profile URL</label>
 
 <div class="flex items-center gap-2"><input type="url" id="apple-link" required
 placeholder="https://music.apple.com/us/artist/..." class="mt-1 block w-full rounded-md
 border-gray-300 shadow-sm"><button type="button" onclick="alert('A new artist profile will be
 created on Apple Music.')" class="btn-secondary px-3 py-2 rounded-md text-sm
 whitespace-nowrap">Create New</button></div>
 
 </div>
 
<div>
 
 <label class="block text-sm font-medium text-gray-700">YouTube Music Artist
 Profile URL</label>
 
 <div class="flex items-center gap-2"><input type="url" id="youtube-link"
 required placeholder="https://music.youtube.com/channel/..." class="mt-1 block w-full
 rounded-md border-gray-300 shadow-sm"><button 
type="button" onclick="alert('A new artist
 pro
<div id="rights-management-agreement" class="hidden mt-6 p-4 border-l-4
 border-red-400 bg-red-50">
 
 <h4 
 class="font-bold text-red-800">Important Certification Required</h4>
 
 <div class="mt-2 flex items-start">
 
 <input type="checkbox" id="rights-agreement-checkbox" 
required class="h-4
 w-4 
 mt-1 rounded border-gray-300 text-purple-600 focus:ring-purple-500">
 
 <label for="rights-agreement-checkbox" class="ml-3 block text-sm
 text-red-700">
 
 By checking this box, I certify that everything in my song is 100% original,
 no loops or samples were used, and that 
I have 100% of the rights to the audio. I understand
 that if caught uploading fraudulent content, my account will be terminated and I will be
 responsible for any resulting legal fees.
</label>
 
 </div>
 
 </div>
document.getElementById('other-genre-specify').required = isOther;
 
 });
 
 // Released Before -> Original Date
 
 document.querySelectorAll('input[name="released-before"]').forEach(radio => {
 
 radio.addEventListener('change', (e) => {
 
 const needsDate = e.target.value === 'yes';
 
 document.getElementById('original-release-date-container').classList.toggle('hidden',
 !needsDate);
 
 document.getElementById('original-release-date').required = needsDate;
 
});
 
 });
// Rights Management -> Agreement Checkbox
 
 const toggleRightsAgreement = () => {
 
 const fbChecked = document.getElementById('facebook-fingerprinting').checked;
const ytChecked = document.getElementById('youtube-content-id').checked;
 
 const needsAgreement = fbChecked || ytChecked;
 
 document.getElementById('rights-management-agreement').classList.toggle('h
}
 
 async function renderReleaseDetails(releaseId) {
 
 contentArea.innerHTML = `<p>Loading release details...</p>`;
const releaseDoc = await getDoc(doc(db, "releases", releaseId));
 
 if 
 (!releaseDoc.exists()) {
 
 contentArea.innerHTML = `<p>Release not found.</p>`;
return;
 
 }
 
 const release = releaseDoc.data();
contentArea.innerHTML = `
 
 <div class="bg-white p-8 rounded-xl shadow-md">
 
 <div class="flex flex-col md:flex-row gap-8">
 
 <img src="${release.artworkUrl}" alt="Artwork" class="w-full md:w-64 h-auto
 md:h-64 rounded-xl object-cover shadow-lg">
 
 <div class="flex-1">
 
<h2 
 class="text-3xl font-bold text-gray-900">${release.songTitle}</h2>
 
 <p class="text-xl text-gray-600 mt-1">${release.primaryArtist}</p>
 
 <div class="mt-4 pt-4 border-t">
 
<p class="text-s
onSnapshot(userRef, async (userDoc) => {
 
 const container = document.getElementById('payouts-container');
 
 if 
 (!container) return;
 
 const userData = userDoc.exists() ? userDoc.data() : { balance: 0 };
 
 const balance = userData.balance || 0;
 
 if 
 (!userData.payoutMethod) {
 
container.innerHTML = `
 
 <h2 
 class="text-2xl font-bold text-gray-800 mb-4">Payouts</h2>
 
 <div class="p-4 text-sm text-red-800 rounded-lg bg-red-100" role="alert">
 
 You must set up a payout method before you can request your earnings.
 
</div>
 
 <button onclick="navigateTo('account-settings')" class="mt-6 btn-primary py-2 px-4
 rounded-md">Go to Account Settings</button>`;
return;
 
 }
 
 const payoutsQuery = query(collection(db, "payouts"), where("userId", "==",
 currentUser.uid), orderBy("requestedAt", "desc"))
<div>
 
 <p class="font-semibold">$${p.amount.toFixed(2)}</p>
 
 <p class="text-xs text-gray-500">${new Date(p.requestedAt.seconds *
 1000).toLocaleDateString()}</p>
 
</div>
 
 <span class="text-xs font-medium px-2.5 py-0.5
 rounded-full">${statusHtml}</span>
 
 </div>
 
 ${reasonHtml}
 
${approvedMsg}
 
 </div>`;
}).join('');
 
 }
 
 container.innerHTML = `
 
 <h2 
 class="text-2xl font-bold text-gray-800 mb-2">Your Earnings</h2>
 
 <p class="text-5xl font-bold theme-text mb-6">$${balance.toFixed(2)}</p>
 
 <button id="request-payout-btn" class="w-full btn-primary py-3 px-4 rounded-lg
 font-bold" ${balance <= 0 ||
hasPendingRequest ? 'disabled' : ''}>
 
 ${hasPendingRequest ?
'Payout R
listEl.innerHTML = releases.length > 0 ? releases.map(renderAdminReleaseCard).join('')
 : 
 `<p>No releases found.</p>`;
 
 });
}
 
 function renderAdminUsers() {
 
 contentArea.innerHTML = `
 
 <div class="bg-white p-6 rounded-xl shadow-md mb-8">
 
 <h3 class="text-xl font-semibold text-gray-800 mb-4">Manage User Balances</h3>
 
 <div id="admin-users-list" class="space-y-4"><p>Loading users...</p></div>
 
 </div>`;
const usersQuery = query(collection(db, "users"), orderBy("name", "asc"));
 
 onSnapshot(usersQuery, (snapshot) => {
 
 const users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
 
 const listEl = document.getElementById('admin-users-list');
 
 if(!listEl) return;
 
 listEl.innerHTML = users.length > 0 ? users.map(user => `
 
 <div class="p-4 
border rounded-lg flex flex-col md:flex-row items-center
 justify-between">
async function handleSavePaymentInfo(e) {
 
 e.preventDefault();
 
 showLoading(true);
 
 const method = e.target.querySelector('input[name="payoutMethod"]:checked').value;
const updateData = { payoutMethod: method };
 
 if 
 (method === 'paypal') {
 
 updateData.paypalEmail = document.getElementById('paypalEmail').value;
} else {
 
 updateData.legalName = document.getElementById('legalName').value;
 
 updateData.mailingAddress = document.getElementById('mailingAddress').value;
}
 
 try {
 
 await updateDoc(doc(db, "users", currentUser.uid), updateData);
showToast('Payout information saved successfully!', 'success');
 
 renderAccountSettings(); // Re-render the view to show the saved info
 
 } catch (error) {
 
 console.error("Error saving payment info:", error);
showToast('Failed to save payout information.', 'error');
 
 } finally {
if 
 (docsFile) {
 
 uploadPromises.push(uploadToCloudinary(docsFile, 'docs-upload-progress'));
}
 
 const [audioUrl, artworkUrl, docsUrl] = await Promise.all(uploadPromises);
if 
 (!audioUrl || !artworkUrl) {
 
 showToast('File upload failed. Please try again.', 'error');
showLoading(false);
 
 return;
 
 }
 
 const genreSelect = document.getElementById('genre');
const releaseData = {
 
 userId: currentUser.uid,
 
 userName: currentUser.displayName,
 
 songTitle: document.getElementById('song-title').value,
 
 primaryArtist: document.getElementById('primary-artist').value,
 
 featuredArtists: document.getElementById('featured-artists').value,
 
releaseDate: document.getElementById('release-date').value,
 
 genre: genreSelect.value === 'Other' ?
document.ge
await addDoc(collection(db, "releases"), releaseData);
 
 showToast('Release submitted successfully for review!', 'success');
 
 navigateTo('my-releases');
} catch (error) {
 
 console.error("Error creating release:", error);
showToast(`Error: ${error.message}`, 'error');
 
 } finally {
 
 showLoading(false);
}
 
 };
 
 async function handleRequestPayout(balance) {
 
 if 
 (balance <= 0) {
 
 showToast("You have no balance to withdraw.", 'error');
return;
 
 }
 
 if 
 (confirm(`You are about to request a payout for your entire balance of
 $${balance.toFixed(2)}. Do you want to continue?`)) {
 
 showLoading(true);
try {
 
 await addDoc(collection(db, "payouts"), {
 
 userId: currentUser.uid,
 
 userName: currentUser.displayName,
 
 userEmail: currentUser.email,
 
amou
await deleteDoc(doc(db, "releases", releaseId));
 
 showToast('Release deleted successfully.', 'success');
 
 } catch (error) {
 
 console.error("Error deleting release:", error);
showToast('Failed to delete release.', 'error');
 
 } finally {
 
 showLoading(false);
}
 
 }
 
 };
window.handleReleaseStatusUpdate = async (releaseId, newStatus) => {
 
 const confirmMsg = newStatus === 'taken down' ?
'Are you sure you want to request a
 takedown for this release?'
: `Are you sure you want to update status to '${newStatus}'?`;
if 
 (confirm(confirmMsg)) {
 
 showLoading(true);
try {
 
 await updateDoc(doc(db, "releases", releaseId), { status: newStatus });
showToast(`Release status updated to '${newStatus}'.`, 'success');
 
 } catch (error) {
 
 console.error("Status update error:", error);
} catch (error) {
 
 console.error("Balance update error:", error);
showToast('Failed to update balance.', 'error');
 
 } finally {
 
 showLoading(false);
}
 
 };
 
 // NEW: Reworked payout handling for Admins
 
 window.handlePayoutAction = async (payoutId, action, userId, amount) => {
 
 if 
 (action === 'approve') {
 
 if 
 (confirm('Are you sure you want to approve this payout? This will deduct the balance
 from the user account.')) {
 
 showLoading(true);
try {
 
 const userRef = doc(db, "users", userId);
const userDoc = await getDoc(userRef);
 
 if 
 (userDoc.exists() && userDoc.data().balance >= amount) {
 
 await updateDoc(userRef, { balance: increment(-amount) });
await updateDoc(doc(db, "payouts", payoutId), { status: 'approved' });
 
 showToast('Payout approved and
}
 
 }
 
 }
 
 }
 
 };
// NEW: Function to open the read-only release details modal
 
 window.handleViewReleaseDetails = async (releaseId) => {
 
 const releaseDoc = await getDoc(doc(db, "releases", releaseId));
if 
 (releaseDoc.exists()) {
 
 const data = releaseDoc.data();
document.getElementById('view-songTitle').value = data.songTitle || '';
 
 document.getElementById('view-primaryArtist').value = data.primaryArtist || '';
 
 document.getElementById('view-featuredArtists').value = data.featuredArtists || '';
 
 document.getElementById('view-releaseDate').value = data.releaseDate || '';
document.getElementById('view-genre').value = data.genre || '';
 
 document.getElementById('view-recordLabel').value = data.recordLabel || '';
 
 document.getElementById('view-upc').value = data.upc || 'Auto-generated';
 
 document.getElementById('view-isrc').value = d
const progressBarContainer = document.getElementById(progressElementId);
 
 const progressBarInner = progressBarContainer.querySelector('.progress-bar-inner');
 
 progressBarContainer.classList.remove('hidden');
 
 progressBarInner.style.width = '0%';
 
 progressBarInner.style.backgroundColor = '#5a4ae3';
 
 const formData = new FormData();
formData.append('file', file);
 
 formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
 
 const xhr = new XMLHttpRequest();
 
 xhr.open('POST',
 `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/upload`, true);
xhr.upload.onprogress = (event) => {
 
 if 
 (event.lengthComputable) {
 
 const percentComplete = (event.loaded / event.total) * 100;
progressBarInner.style.width = `${percentComplete}%`;
 
 }
 
 };
xhr.onload = () => {
 
 if
const canView = ['approved', 'delivered', 'taken down'].includes(release.status);
 
 return `
 
 <div class="p-4 border rounded-lg bg-white shadow-sm flex flex-col md:flex-row items-start
 md:items-center gap-4">
 
 <div class="flex items-center gap-4 flex-1">
 
 <img src="${release.artworkUrl}" alt="Artwork" class="w-12 h-12 rounded-md
 object-cover">
 
 <div>
 
<p class="font-semibold text-gray-800">${release.songTitle}</p>
 
 <p class="text-sm text-gray-500">${release.primaryArtist} &bull;
Release:
 ${release.releaseDate}</p>
 
 </div>
 
 </div>
 
 <div class="flex items-center gap-4 mt-2 md:mt-0">
 
 <span class="text-xs font-medium px-2.5 py-0.5 rounded-full
 ${statusColors[release.status] || ''}">${release.status}</span>
 
 ${canView ?
`<button onclick="handleViewReleaseDetails('${release.id}')"
 class="text-sm btn-secondary py-1 px-
<button onclick="window.handleReleaseStatusUpdate('${release.id}', 'delivered')"
 class="bg-green-500 hover:bg-green-600 text-white text-sm font-bold py-1 px-3
 rounded-lg">Mark Delivered</button>
 
 <button onclick="window.handleReleaseStatusUpdate('${release.id}', 'taken down')"
 class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-1 px-3 rounded-lg">Take
 Down</button>`;
break;
 
 case 'delivered':
 
 actionsHtml = `<button onclick="window.handleReleaseStatusUpdate('${release.id}',
 'taken down')" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-1 px-3
 rounded-lg">Take Down</button>`;
break;
 
 default:
 
 actionsHtml = `<p class="text-xs text-gray-500">No actions available.</p>`;
}
 
 const statusColors = { pending: 'border-yellow-400', approved: 'border-blue-400', delivered:
 'border-green-400', rejected: 'border-red-400', 'tak
// MODIFICATION START: Added "View Details" button for admins on pending releases.
 function renderAdminReleaseCard(release) {
 let actionsHtml = '';
 switch (release.status) {
 case 'pending':
 actionsHtml = `
 <button onclick="window.handleViewReleaseDetails('${release.id}')" class="bg-gray-200 hover:bg-gray-300 text-gray-800 text-sm font-bold py-1 px-3 rounded-lg">View Details</button>
 <button onclick="window.handleReleaseStatusUpdate('${release.id}', 'approved')" class="bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold py-1 px-3 rounded-lg">Approve</button>
 <button onclick="window.handleReleaseStatusUpdate('${release.id}', 'rejected')" class="bg-red-500 hover:bg-red-600 text-white text-sm font-bold py-1 px-3 rounded-lg">Reject</button>`;
 break;
 case 'approved':
 actionsHtml = `
 <button onclick="window.handleReleaseStatusUpdate('${release.id}', 'delivered')" class="bg-green-500 hover:bg-green-600 text-white text-sm font-bold py-1 px-3 rounded-lg">Mark Delivered</button>
 <button onclick="window.handleReleaseStatusUpdate('${release.id}', 'taken down')" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-1 px-3 rounded-lg">Take Down</button>`;
 break;
 case 'delivered':
 actionsHtml = `<button onclick="window.handleReleaseStatusUpdate('${release.id}', 'taken down')" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-bold py-1 px-3 rounded-lg">Take Down</button>`;
 break;
 default:
 actionsHtml = `<p class="text-xs text-gray-500">No actions available.</p>`;
 }
 const statusColors = { pending: 'border-yellow-400', approved: 'border-blue-400', delivered: 'border-green-400', rejected: 'border-red-400', 'taken down': 'border-gray-400' };
 return `
 <div class="p-4 bg-white rounded-xl shadow-md border-l-4 ${statusColors[release.status] || 'border-gray-200'}">
 <div class="flex flex-col md:flex-row md:items-center md:justify-between">
 <div class="flex items-center gap-4">
 <img src="${release.artworkUrl}" alt="Artwork" class="w-16 h-16 rounded-lg object-cover">
 <div>
 <p class="font-bold text-lg text-gray-800">${release.songTitle}</p>
 <p class="text-sm text-gray-600">by <span class="font-medium">${release.primaryArtist}</span></p>
 <p class="text-xs text-gray-500 mt-1">Submitted by: ${release.userName || 'N/A'}</p>
 </div>
 </div>
 <div class="flex items-center gap-2 mt-4 md:mt-0">
 ${actionsHtml}
 </div>
 </div>
 </div>`;
 }
// MODIFICATION END
document.getElementById('mobile-menu').classList.remove('hidden');
 
 });
 
 document.getElementById('mobile-menu-close').addEventListener('click', () => {
 
 document.getElementById('mobile-menu').classList.add('hidden');
 
 });
document.getElementById('mobile-menu-overlay').addEventListener('click', () => {
 
 document.getElementById('mobile-menu').classList.add('hidden');
 
 });
 </script>
 </body>
 </html>
